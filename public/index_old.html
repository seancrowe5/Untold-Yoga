<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Untold Yoga</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet' type='text/css'>
  
  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/custom.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="img/favicon.png">

</head>
<body>

  <section class="hero fullscreen">
    <div class="container">
      <div class="row middle">
        <div class="ten columns">
          <img class="logo" src="img/untold-logo.png"/>
          <h3 class="hero-content">Secret yoga classes in beautiful spaces around Chicago</h3>
          <div id="form-messages"></div>
          <div class="registerbox">
            <p>Next class is on Sunday July 24th at 11:00 am at a secret spot somewhere cool ;)</p>
            <form id="registerform" novalidate>
              <span class="input input--ruri">
                <input type="text" name="name" id="name" class="input__field input__field--ruri" />
                <label class="input__label input__label--ruri" for="name">
                  <span class="input__label-content input__label-content--ruri">name</span>
                </label>
              </span>
              <span class="input input--ruri">
                <input type="email" name="email" id="email" class="input__field input__field--ruri" />
                <label class="input__label input__label--ruri" for="email">
                  <span class="input__label-content input__label-content--ruri">email</span>
                </label>
              </span>
              <span class="input input--ruri">
                <input type="tel" name="phone" id="phone" class="input__field input__field--ruri" />
                <label class="input__label input__label--ruri" for="phone">
                  <span class="input__label-content input__label-content--ruri">phone</span>
                </label>
              </span>         
            </form>
            <button type="button" name="select" onclick="if(validateForm()){submitForm();}">Submit</button>
              
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="masthead-middle center halfscreen">
    <div class="container">
      <div class="row middle">
        <div class="twelve columns">
          <h4>Share your practice with our curated community of yogis and incredible instructors</h4>
        </div>
      </div>
    </div>
  </section>

  <section class="masthead-bottom center fullscreen">
    <div class="container">
      <div class="row middle">
        <div class="ten columns">
          <h3>How do I get in?</h3>
          <div class="masthead-bottom-list">
            <h4>1. Apply for our next class</h4>
            <h4>2. Get details... if accepted!</h4>
            <h4>3. Show up and enjoy! :)</h4>
          </div>
          <button id="apply-button">APPLY NOW</button>
        </div>
      </div>
    </div>
  </section>

</body>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classie/1.0.1/classie.min.js"></script>
  <script src="js/jquery.email-autocomplete.min.js"></script>
  <script src="js/scale.fix.js"></script>
  <script src="js/formatter.js"></script>
  
<script>            
  $(document).ready(function () {
    var offset = 200;
    var duration = 400;
    
    $(window).scroll(function() {
      if ($(this).scrollTop() > offset) {
        $('#apply-button').fadeIn(duration);
      } else {
        $('#apply-button').fadeOut(duration);
      }
    });
    $('#apply-button').click(function(event) {
      event.preventDefault();
      $('html, body').animate({scrollTop: 0}, duration);
      return false;
    })
    
  if (!String.prototype.trim) {
  (function() {
      // Make sure we trim BOM and NBSP
      var rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;
      String.prototype.trim = function() {
          return this.replace(rtrim, '');
      };
  })();
}

  [].slice.call( document.querySelectorAll( 'input.input__field' ) ).forEach( function( inputEl ) {
  // in case the input is already filled..
  if( inputEl.value.trim() !== '' ) {
      classie.add( inputEl.parentNode, 'input--filled' );
  }

  // events:
  inputEl.addEventListener( 'focus', onInputFocus );
  inputEl.addEventListener( 'blur', onInputBlur );
} );

function onInputFocus( ev ) {
  classie.add( ev.target.parentNode, 'input--filled' );
}

function onInputBlur( ev ) {
  if( ev.target.value.trim() === '' ) {
      classie.remove( ev.target.parentNode, 'input--filled' );
  }
}
    $('form').each(function() {
        $(this).find('input').keypress(function(e) {
            // Enter pressed?
            if(e.which == 10 || e.which == 13) {
              if( validateForm() ){
                submitForm();
              }  
            }
        });
    });
    
  });
  
/*  new Formatter(document.getElementById('phone'), {
    'pattern': '({{999}}) {{999}} - {{9999}}',
    'persistent': false
  });*/
  
  function validateForm() { 
    var i = 0;
    var namer = 'error';
    var emailr = 'error';
    var phoner = 'error';
    var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    
    if ( $('input#name').val().length > 3 ) {
      namer = 'success';
      i++;
    } if ( emailReg.test($('input#email').val()) && $('input#email').val().length > 5 ) {
      emailr = 'success';
      i++;
    } if ( $('input#phone').val().replace(/\D/g,'').length == 10 || $('input#phone').val().replace(/\D/g,'').length == 11 ) {
      phoner = 'success';
      i++;
    }

    if ( i != 3) {
      $('input').blur();
      $('input#name').addClass(namer);
      $('input#email').addClass(emailr);
      $('input#phone').addClass(phoner);
      $(".registerbox").effect( "shake", {times:2, distance: 7}, 350 );
      /*$('#form-messages').text('You do have to fill this stuff out, you know.');*/
      return false;
    } else {
      return true;
    }
  }

  function submitForm() {
    // Get the form.
    var form = $('#registerform');

    // Get the messages div.
    var formMessages = $('#form-messages');

    // Serialize the form data.
    var formData = $(form).serialize();

    // Submit the form using AJAX.
    $.ajax({
      type: 'POST',
      url: 'untold.php', 
      data: formData
    })
    .done(function(response) {
      // Make sure that the formMessages div has the 'success' class.
      $(formMessages).removeClass('error');
      $(formMessages).addClass('success');

      // Set the message text.
      $(formMessages).text(response);

      // Clear the form.
      $('#name').val('');
      $('#email').val('');
      $('#phone').val('');
    })
    .fail(function(data) {
      // Make sure that the formMessages div has the 'error' class.
      $(formMessages).removeClass('success');
      $(formMessages).addClass('error');

      // Set the message text.
      if (data.responseText !== '') {
          $(formMessages).text(data.responseText);
      } else {
          $(formMessages).text('Oops! An error occured and your message could not be sent.');
      }
    });
  }
</script>
</html>
